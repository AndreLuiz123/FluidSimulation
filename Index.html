<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="Fluido.js"></script>
    <title>Document</title>
</head>
<body>

    
    
    <div>
        <canvas></canvas>
        <button id="difusão">Difusão</button>
        <button id="advecção">Advecção</button>
        <button id="projeção">Projeção</button>
        <button id="rodarDifusao">Rodar Difusão</button>
        <button id="rodarAdveccao">Rodar Advecção</button>
        <button id="rodarTudo">Rodar Tudo</button>
        <button id="pausar">Pausar</button>
        <button id="mudarDesenho">Mudar Desenho</button>
    </div>
    
            <div>
                <label for="col">Coluna:</label>
                <input type="number" id="coluna" value="1"/>
    
                <label for="lin">Linha:</label>
                <input type="number" id="linha" value="1"/>
    
                <label for="dens">Densidade:</label>
                <input type="number" id="densidade" value="10"/>
                
            </div>
            <div class="button">
                <button id="botaoDensidade">Add Densidade</button>
            </div>
    
            <div>
                <label for="col2">Coluna:</label>
                <input type="number" id="colunaVetor" value="1"/>
    
                <label for="lin2">Linha:</label>
                <input type="number" id="linhaVetor" value="1"/>
    
                <label for="vetorX">Vetor X:</label>
                <input type="number" id="vetorX" value="10"/>
                <label for="vetorY">Vetor Y:</label>
                <input type="number" id="vetorY" value="10"/>
                
            </div>
            <div class="button">
                <button id="botaoVelocidade">Add Velocidade</button>
            </div>

    
<script>

        var canvas = document.querySelector("canvas");
        canvas.width = 512;
        canvas.height = 512;
        var ctx = canvas.getContext("2d");

        var anterior = 0;
        var dt = 0;

        var fluido = new Fluido();

        fluido.criarGrids();

        var pode=false, pode2=false, pode3=false;
        
        function passo(t)
        {
            dt = (t-anterior)/1000;

            ctx.fillStyle = "rgb(0,0,0)";
            ctx.fillRect(0,0,canvas.width, canvas.height);


            if(mudaCor)
            fluido.desenharFluidoDensidade(ctx);
            else
            fluido.desenharFluidoVelocidade(ctx);
            
            if(pode)
            {
                fluido.atualizarGrid0();
                fluido.diffusion('densidade',0);
            }
            
            if(pode2)
            {
                fluido.atualizarGrid0();
                fluido.advection('densidade',0);
            }
            if(pode3)
            {
                dens_step();
                vel_step();
            }

            requestAnimationFrame(passo);
        }

        function dens_step()
        {
            fluido.atualizarGrid0();
            fluido.diffusion('densidade',0);
            fluido.atualizarGrid0();
            fluido.advection('densidade',0);
        }
        
        function vel_step()
        {
            fluido.atualizarGrid0();
            fluido.diffusion('vetorX',1);
            fluido.atualizarGrid0();
            fluido.diffusion('vetorY',2);
            fluido.projection();
            fluido.atualizarGrid0();
            fluido.advection('vetorX',1);
            fluido.atualizarGrid0();
            fluido.advection('vetorY',2);
            fluido.projection();
        }

        function difusao()
        {
            //fluido.projection();
            fluido.diffusion('densidade',0);
           // fluido.diffusion('vetorX',1);
           // fluido.diffusion('vetorY',2);
        }
        var varBotao = document.getElementById("difusão");
        varBotao.addEventListener("click", difusao);

        function adveccao()
        {
            fluido.advection('densidade',0);
           // fluido.advection('vetorX',1);
           // fluido.advection('vetorY',2);            
           //fluido.addAdvection();
        }
        var varBotao = document.getElementById("advecção");
        varBotao.addEventListener("click", adveccao);
        
        var densidade = document.getElementById("densidade");
        var coluna = document.getElementById("coluna");
        var linha = document.getElementById("linha");
        var botaoDensidade = document.getElementById("botaoDensidade");
  
        function valorNovoDensidadeCelula()
        {
            var a = Number(coluna.value);
            var b = Number(linha.value);
            var c = Number(densidade.value);
            
            if(a<0)
                a = 0;
            if(a>fluido.tamOriginal-1)
                a = fluido.tamOriginal-1;

            if(b<0)
                b = 0;
            if(b>fluido.tamOriginal-1)
                b = fluido.tamOriginal-1;
            
            fluido.grid[a][b].densidade = c; 
            fluido.grid0[a][b].densidade = c; 
        }
        botaoDensidade.addEventListener("click", valorNovoDensidadeCelula);
        
        
        //---------------------------------------------------
        
        var vetorX = document.getElementById("vetorX");
        var vetorY = document.getElementById("vetorY");
        var colunaVetor = document.getElementById("colunaVetor");
        var linhaVetor = document.getElementById("linhaVetor");
        var botaoVelocidade = document.getElementById("botaoVelocidade");

        function valorNovoVelocidadeCelula()
        {
            var a = Number(colunaVetor.value);
            var b = Number(linhaVetor.value);
            var c = Number(vetorX.value);
            var d = Number(vetorY.value);
            
            if(a<0)
                a = 0;
            if(a>fluido.tam-1)
                a = fluido.tam-1;

            if(b<0)
                b = 0;
            if(b>fluido.tam-1)
                b = fluido.tam-1;

            fluido.grid[a][b].vetorX = c;
            fluido.grid[a][b].vetorY = d; 
        }
        botaoVelocidade.addEventListener("click", valorNovoVelocidadeCelula);
       
        //------------------------------------------------------------------------
        var botaoRodarDifusao = document.getElementById("rodarDifusao");
        botaoRodarDifusao.addEventListener("click", function(){
            if(pode)
                pode = false;
            else
                pode = true;
        })

        var botaoRodarAdveccao = document.getElementById("rodarAdveccao");
        botaoRodarAdveccao.addEventListener("click", function(){
            if(pode2)
                pode2 = false;
            else
                pode2 = true;
        })

        var botaoRodarTudo = document.getElementById("rodarTudo");
        botaoRodarTudo.addEventListener("click", function(){
            if(pode3)
                pode3 = false;
            else
                pode3 = true;
        })

        var botaoPausar = document.getElementById("pausar");
        botaoPausar.addEventListener("click", function(){
            pode = false;
            pode2 = false;
            pode3 = false;
        })

        var botaoMudarDesenho = document.getElementById("mudarDesenho");
        var mudaCor = false;
        botaoMudarDesenho.addEventListener("click", function(){
            if(mudaCor)
                mudaCor = false;
            else
                mudaCor = true;
        })


        addEventListener("mouseclick", function(e){
            

        })

        requestAnimationFrame(passo);
    </script>
</body>
</html>